<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Live Insider Terminal</title>
    <style>
        /* DARK THEME COLORS */
        :root {
            --bg-color: #0e1117;
            --card-color: #1e1e1e;
            --text-color: #fafafa;
            --border-color: #31333f;
            --buy-green: rgba(0, 255, 0, 0.15);
            --sell-red: rgba(255, 75, 75, 0.15);
        }

        body { 
            font-family: sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text-color); 
            margin: 0; 
            padding: 20px;
        }

        h1 { text-align: center; color: #aaa; font-weight: 300; }

        /* STATUS INDICATOR */
        #status-bar {
            text-align: center;
            margin-bottom: 20px;
            font-size: 14px;
        }

        /* TICKER CARD */
        .ticker-card { 
            background: var(--card-color);
            border: 1px solid var(--border-color); 
            padding: 20px; 
            border-radius: 12px; 
            margin: 0 auto 30px auto; 
            max-width: 1400px;
        }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }

        /* SCROLLABLE TABLE SETTINGS */
        .table-container {
            height: 300px; /* Fixed height for each CE/PE list */
            overflow-y: auto; /* Enable scrolling */
            border: 1px solid #333;
            background: #161616;
        }

        table { 
            width: 100%; 
            border-collapse: collapse; 
            font-size: 14px; 
        }

        /* Fixed Header Logic */
        thead th { 
            position: sticky; 
            top: 0; 
            background: #252525; 
            z-index: 10;
            padding: 12px;
            text-align: left;
            color: #888;
            font-size: 11px;
            text-transform: uppercase;
        }

        td { padding: 10px; border-bottom: 1px solid #222; }

        /* ROW COLORS */
        .buy { background-color: var(--buy-green) !important; color: #00ff00; }
        .sell { background-color: var(--sell-red) !important; color: #ff4b4b; }

        /* Custom Scrollbar for Brave/Chrome */
        .table-container::-webkit-scrollbar { width: 6px; }
        .table-container::-webkit-scrollbar-thumb { background: #444; border-radius: 10px; }
    </style>
</head>
<body>

    <h1>Live Equity Option Insider Detector</h1>
    <div id="status-bar">Connection: <span id="status">Connecting...</span></div>
    
    <div id="dashboard"></div>

    <script>
        const ws = new WebSocket("ws://localhost:8000/ws");
        const dashboard = document.getElementById('dashboard');
        const status = document.getElementById('status');

        ws.onopen = () => { status.innerText = "üü¢ LIVE"; status.style.color = "#00ff00"; };
        ws.onclose = () => { status.innerText = "üî¥ DISCONNECTED"; status.style.color = "#ff4b4b"; };

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            updateUI(data);
        };

        function updateUI(trade) {
        let tickerDiv = document.getElementById(`ticker-${trade.ticker}`);
        
        if (!tickerDiv) {
            tickerDiv = document.createElement('div');
            tickerDiv.id = `ticker-${trade.ticker}`;
            tickerDiv.className = 'ticker-card';
            tickerDiv.innerHTML = `
                <h3 style="margin-top:0;">üåê ${trade.ticker}</h3>
                <div class="grid">
                    <div>
                        <h4 style="color:#4a90e2;">üîµ Calls (CE)</h4>
                        <div class="table-container">
                            <table id="ce-${trade.ticker}">
                                <thead><tr><th>Time</th><th>Strike</th><th>Value</th><th>Move</th><th>OI</th></tr></thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                    <div>
                        <h4 style="color:#f5a623;">üü† Puts (PE)</h4>
                        <div class="table-container">
                            <table id="pe-${trade.ticker}">
                                <thead><tr><th>Time</th><th>Strike</th><th>Value</th><th>Move</th><th>OI</th></tr></thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>`;
            dashboard.prepend(tickerDiv);
        }

        const tableId = `${trade.option_type.toLowerCase()}-${trade.ticker}`;
        const tbody = document.getElementById(tableId).querySelector('tbody');
        const row = tbody.insertRow(0);
        
        row.className = (trade.category === "AGGRESSIVE_BUYING" || trade.category === "INSTITUTIONAL_ACCUMULATION") ? "buy" : "sell";

        // Format OI with commas (e.g., 1,250,000)
        const formattedOI = trade.oi ? trade.oi.toLocaleString() : '0';

        row.innerHTML = `
            <td>${trade.timestamp}</td>
            <td>${trade.strike}</td>
            <td>‚Çπ${Math.round(trade.value).toLocaleString()}</td>
            <td>${trade.price_move.toFixed(2)}</td>
            <td style="font-weight:bold; color:#aaa;">${formattedOI}</td> `;

        if (tbody.rows.length > 50) tbody.deleteRow(50);
    }
    </script>
</body>
</html>